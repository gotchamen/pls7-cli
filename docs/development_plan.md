## 📝 Development Plan (Step-by-Step)

### **1단계: 프로젝트 뼈대 구축 (Cobra & 디렉토리)**

* **목표**: 명령어로 실행 가능한 가장 기본적인 "Hello World" 앱 만들기.
* **결과물**: `go run main.go play` 명령어를 터미널에 입력하면 환영 메시지가 출력되는, 뼈대만 갖춘 CLI 애플리케이션.
* **완료여부**: ✅

---

### **2단계: 기본 데이터 모델 구현 (Card & Deck)**

* **목표**: 카드와 덱을 코드로 구현하고, 셔플된 덱을 화면에 출력하기.
* **결과물**: 실행할 때마다 무작위로 섞인 카드가 화면에 출력되는 앱.
* **완료여부**: ✅

---

### **3단계: 정적(Static) 핸드 시뮬레이션**

* **목표**: 게임 흐름 없이, 카드 분배가 완료된 한순간의 테이블 상황을 화면에 보여주기.
* **결과물**: 6명의 플레이어 패와 커뮤니티 카드가 모두 깔린, 한 판의 정지된 스냅샷이 화면에 출력되는 앱.
* **완료여부**: ✅

---

### **4단계: 족보 판정 로직 구현 및 테스트**

* **목표**: 가장 복잡한 족보 판정 로직을 단위 테스트를 통해 독립적으로 완성하기.
* **결과물**: 정적 핸드 상황에서 각 플레이어의 하이/로우 핸드 족보를 정확히 계산하여 알려주는 앱.
* **완료여부**: ✅

---

### **5단계: 게임 흐름 및 상태 관리 구현**

* **목표**: 실제 게임 한 판의 흐름(라운드, 베팅, 플레이어 상태 등)을 관리하는 데이터 구조와 자동 진행 로직의 뼈대를 만들기.
* **주요 작업**:
  1.  `Player`와 `Game` 구조체에 칩, 상태, 팟, 페이즈 등 동적 필드 추가. (✅)
  2.  순환 참조를 피해, `cmd/play.go`가 지휘하는 자동 게임 루프(Pre-flop -> Flop -> Turn -> River) 구현. (✅)
  3.  실제 블라인드(SB/BB) 베팅 로직 구현 및 정확한 팟 계산 확인. (✅)
* **결과물**: 사용자 입력 없이 프리플랍부터 리버까지 카드 깔리는 과정이 순차적으로 보이고, 블라인드 팟이 정확히 계산되는 '시네마틱 모드' 게임.
* **완료여부**: ✅

---

### **6단계: 상호작용 가능한 베팅 라운드 구현**

* **목표**: 플레이어가 직접 자신의 턴에 명령어를 입력하고, 게임이 그에 반응하게 하기.
* **주요 작업**:
  1.  `PlayerAction` 데이터 구조 정의. (✅)
  2.  사용자 입력을 받는 프롬프트(`internal/cli/input.go`) 구현. (✅)
  3.  `Fold`, `Check`, `Call` 액션 처리 로직 구현. (✅)
  4.  `cmd/play.go`의 메인 루프가 플레이어 턴에 멈추고 입력을 기다리도록 수정. (✅)
* **결과물**: 사용자가 직접 폴드, 체크, 콜을 하며 참여할 수 있는, 최초의 **플레이 가능한 버전**.
* **완료여부**: ✅

---

### **7단계: 고급 베팅 로직 및 팟 리밋 구현**

* **목표**: 실제 포커 게임처럼 베팅과 레이즈가 오고 가는 완전한 베팅 라운드를 구현.
* **주요 작업**:
  * 사용자로부터 `Bet`, `Raise` 금액을 입력받는 로직 추가. (✅)
  * 팟 리밋(Pot-Limit) 규칙에 따라 베팅/레이즈 가능한 최소/최대 금액 계산 로직 구현. (✅)
  * 한 명의 베팅/레이즈 이후, 다른 모든 플레이어에게 다시 액션 기회가 돌아가는 완전한 베팅 루프 로직 구현. (✅)
* **완료여부**: ✅

---

### **8단계: 전체 기능 완성 및 CPU AI 구현**

* **목표**: 나머지 기능들을 추가하고 CPU AI를 구현하여 완전한 싱글 플레이어 게임으로 발전시키기.
* **주요 작업**:
  * 팟 분배(Pot Distribution) 로직 구현. (✅)
  * 게임 오버 및 다음 핸드 시작 로직 구현. (✅)
  * 정의했던 난이도별(Easy, Medium, Hard) CPU AI 로직 구현. (✅)
* **완료여부**: ✅

---

### **9단계: 최종 폴리싱 및 리팩토링**

* **목표**: 전체 코드를 정리하고, 테스트를 추가하여 배포 준비 완료.
* **주요 작업**:
  * 개발 모드 및 로깅 시스템 도입. (✅)
  * 조건부 화면 클리어 기능 구현. (✅)
  * 정확한 팟 리밋(Pot-Limit) 계산 로직. (✅)
  * 베팅 루프 안정성 강화를 위한 테스트 추가:
    * 다양한 올인(All-in) 시나리오 테스트 (한 명 올인, 여러 명 올인과 사이드 팟, 최소 레이즈 미만 올인). (✅)
    * 다양한 폴드(Fold) 시나리오 테스트 (빅 블라인드 제외 모두 폴드, 베팅에 모두 폴드).
    * 라운드 정상 종료 시나리오 테스트 (빅 블라인드의 체크로 종료, 레이즈 후 모두 콜하여 종료).
* **완료여부**: ⏳ (현재 진행 중)

---

### **10단계: Lowless 모드 구현**

* **목표**: `--lowless` 옵션을 통해 하이 족보만으로 게임을 진행하는 모드를 구현.
* **주요 작업**:
  1.  `cmd/play.go`에 `--lowless` Cobra 플래그 추가. (✅)
  2.  `game.Game` 구조체에 `LowlessMode` 필드 추가 및 초기화. (✅)
  3.  `game.EvaluateHand` 함수 호출 시 `LowlessMode` 값 전달. (✅)
  4.  `game.DistributePot` 함수에서 `LowlessMode`에 따라 로우 핸드 판정 및 분배 로직 스킵. (✅)
  5.  `cli.DisplayGameState` 함수에서 `LowlessMode`에 따라 로우 핸드 정보 표시 스킵. (✅)
  6.  `ai.go`의 AI 로직에서 `LowlessMode`에 따라 로우 핸드 관련 판단 로직 조정 (필요시). (✅)
  7.  `evaluation_test.go`에 `LowlessMode` 관련 테스트 케이스 추가. (✅)
* 기타: `--lowless` 옵션은 제거되었고, 게임 룰 파일 (YAML) 에서 `low_hand.enabled` 플래그로 대체됨.
* **완료여부**: ✅

---

### **11단계: Pot Odds & Equity 계산 기능 구현 (TDD)**

*   **목표**: 개발 모드에서 플레이어에게 Pot Odds, Equity, Outs 등 유용한 정보를 표시하여 더 나은 의사결정을 돕는다.
* **주요 작업**:
  1. `pkg/poker/`에 아웃츠(Outs) 계산 로직 및 테스트 추가.
      - 플러시 드로우 아웃츠 계산 (✅)
      - 스트레이트 드로우 아웃츠 계산 (✅)
      - 트리플(포켓페어 only) 드로우 아웃츠 계산 (✅)
      - 풀 하우스(포켓페어 only) 드로우 아웃츠 계산 (✅)
      - 포카드(포켓페어 only) 드로우 아웃츠 계산 (✅)
      - 스킵 스트레이트 드로우 아웃츠 계산 (✅)
      - 스트레이트 플러시 드로우 아웃츠 계산 (✅)
      - 스킵 스트레이트 플러시 드로우 아웃츠 계산 (✅)
      - 로우 핸드 드로우 아웃츠 계산 (✅)
  2. `internal/cli/display.go`에 드로우 아우츠 카드들 표시 로직 추가 (`--dev` 모드, 플레이어 한정). (✅)
  3. `pkg/poker/`에 Equity 및 Pot Odds 계산 로직 및 테스트 추가. 
      - Equity 계산 로직 (✅)
      - Pot Odds 계산 로직 (✅)
  4. `internal/cli/display.go`에 계산된 정보 표시 로직 추가 (`--dev` 모드, 플레이어 한정). (✅)
  5. 전체 기능 테스트 및 리팩토링. (✅)
* **완료여부**: ✅

---

### **12단계: AI 고도화**

*   **목표**: AI 를 더 똑똑하게 만들어, 플레이어의 핸드와 게임 상황에 따라 최적의 액션을 선택하도록 한다.
* **주요 작업**:
  1.  **AI 전략 다각화**: tight/loose, aggressive/passive 속성으로 총 네 가지 AI 행동양식을 구현한다. (✅)
  2.  **난이도별 다른 유형의 AI 배치**: 커맨드 수행시 `--difficulty` 옵션에 따라 플레이어를 상대하는 AI 유형을 다르게 배치한다. (✅)
      - Easy: Loose-Passive (LAP) AI 5명
      - Medium: Loose-Passive (LAP) AI 2명, Tight-Passive (TAP) AI 3명
      - Hard: Tight-Passive (TAP) AI 1명,  Loose-Aggressive (LAG) AI 2명, Tight-Aggressive (TAG) AI 2명
  3.  **dev 모드에서 AI 유형 보여주기**: `--dev` 모드에서 각 CPU 플레이어의 AI 유형을 표시한다. (✅)
* **완료여부**: ✅

---

### **13단계: 범용 포커 게임 엔진으로 리팩토링 Pt.1**

*   **목표**: 단일 게임(PLS7) 애플리케이션을, 룰(YAML) 파일을 통해 다양한 포커 게임(NLH, PLO 등)을 지원할 수 있는 범용 엔진으로 추상화한다.
* **주요 작업**:
    1.  **룰 파일(YAML) 구조 정의 및 Go 데이터 구조 생성**: 게임 룰(홀카드, 베팅, 족보 등)을 정의할 YAML 파일 구조를 설계하고, 이를 Go 코드로 불러올 `game.GameRules` 구조체를 구현한다. (✅)
    2.  **`Game` 구조체 및 생성자 수정**: `game.Game`이 하드코딩된 룰 대신 `GameRules` 객체를 사용하도록 필드를 추가하고, `NewGame` 생성자에서 이를 받아 초기화하도록 변경한다. (✅)
    3.  **CLI 명령어(`cmd/root.go`) 수정**: `--rule` 플래그를 추가하여 사용자가 YAML 파일로 정의된 특정 게임 룰을 선택하여 실행할 수 있도록 수정한다. (✅)
    4.  **족보 판정 로직(`evaluation.go`) 리팩토링**: `EvaluateHand` 함수가 `GameRules`를 인자로 받아, 룰에 명시된 홀카드 사용 규칙과 사용 가능한 족보에 따라 동적으로 핸드를 판정하도록 수정한다. (✅)
    5.  **베팅 리밋 로직 추상화**: `BettingLimitCalculator` 인터페이스를 도입하고, 팟 리밋, 노 리밋 등 규칙에 맞는 구현체를 만들어 `GameRules`에 따라 선택적으로 사용하도록 변경한다. (✅)
    6.  **홀카드 사용 방식 추상화**: `hole_cards.use_constraint` 규칙(`any`, `exact` 등)에 따라 핸드 조합을 생성하는 로직을 인터페이스 기반으로 추상화하고, 룰에 맞는 구현체를 동적으로 사용하도록 변경한다.
    7.  **전체 테스트 및 검증**: 리팩토링된 구성 요소가 올바르게 동작하는지 검증하기 위해 각 게임 룰(PLS7, NLH, PLO)에 대한 단위 테스트 및 통합 테스트를 작성하고 실행한다.
* **완료여부**: ⏳ (현재 진행 중)

---

### **14단계: 패키지 구조 리팩토링 (책임 분리 강화)**

*   **목표**: `poker-engine`과 `poker-cli` 분리를 위한 사전 작업으로, 패키지 간의 역할과 책임을 명확히 하고 잘못된 의존성을 바로잡는다.
* **주요 작업**:
    *   **14-1. `pkg/poker` 의존성 문제 해결**
        - [x] `GameRules` 구조체를 `internal/config` -> `pkg/poker` 로 이동
        - [x] `internal/config`가 `pkg/poker`를 import 하도록 수정
        - [x] `JoinStrings` 유틸리티 함수를 `internal/util` -> `pkg/poker` 로 이동
    *   **14-2. `game`과 `cli`의 책임 분리**
        - [x] `internal/game` 패키지 내의 모든 `fmt.Print*` 호출 제거
        - [x] `ExecuteBettingLoop`에서 `displayCurrentStatus` 콜백 제거
        - [x] `cmd/root.go`의 메인 게임 루프를 `internal/game`으로 이동
    *   **14-3. 게임 인터랙션 개선 (턴 기반 로직으로 변경)**
        *   **목표**: `game` 패키지가 한 턴씩 게임을 진행하도록 변경하고, `cmd`가 이를 반복 호출하며 딜레이와 출력을 제어하도록 하여 인터랙티브한 UX를 복원한다.
        *   **주요 작업**:
            *   **14-3-1. 베팅 라운드 종료 조건 함수 구현 (TDD)**
                - [x] `game.IsBettingRoundOver() bool` 메소드 및 테스트 케이스 추가
            *   **14-3-2. 턴 관리 로직 구현 (TDD)**
                - [x] `game.CurrentPlayer() *Player` 메소드 추가
                - [x] `game.AdvanceTurn()` 메소드 및 테스트 케이스 추가
            *   **14-3-3. 기존 루프 로직 제거**
                - [x] `game.RunHand()` 메소드 제거
                - [x] `game.ExecuteBettingLoop()` 메소드 제거 (또는 내부 로직 비우기)
            *   **14-3-4. `cmd/root.go`에 새로운 턴 기반 루프 구현**
                - [x] `cmd/root.go`의 `runGame` 함수에 새로운 베팅 루프 로직 작성
                - [x] CPU 턴 딜레이(`time.Sleep`) 로직 추가
    *   **14-4. `util` 패키지 정리 및 `cli` 책임 강화**
        - [x] `FormatNumber` 함수를 `internal/util` -> `internal/cli` 로 이동
        - [x] `FormatShowdownResults` 함수를 `internal/game` -> `internal/cli` 로 이동
* **완료여부**: ⬜ (진행 예정)

---

### **15단계: poker-engine, poker-cli 분리 (모노레포 방식)**

*   **목표**: 현재 레포지토리를 Go Workspaces를 이용한 모노레포로 전환하고, `poker-engine`과 `poker-cli`를 별도의 모듈로 분리한다.
* **주요 작업**:
    - [ ] `go.work` 파일을 사용하여 워크스페이스 설정
    - [ ] `/engine`, `/cli` 디렉토리 구조 생성
    - [ ] `poker-engine` 관련 패키지(`pkg/poker`, `internal/game`, `internal/config`)를 `/engine`으로 이동
    - [ ] `poker-cli` 관련 패키지(`cmd`, `internal/cli`, `internal/util`)를 `/cli`로 이동
    - [ ] 각 모듈의 `go.mod` 파일 생성 및 의존성 정리
    - [ ] `go.work`를 통해 `cli`가 `engine`을 올바르게 참조하는지 확인 및 빌드 테스트
* **완료여부**: ⬜ (진행 예정)
