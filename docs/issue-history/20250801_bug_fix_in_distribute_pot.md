## 질문

> 너가 변경해서 버그를 수정한 DistributePot 함수의 로직에 대해 최대한 자세히 설명해줘.

## 답변

제가 수정한 DistributePot 함수의 로직에 대해 자세히 설명해 드리겠습니다.

핵심 목표는 **"폴드한 플레이어의 베팅 금액을 유실하지 않고, 모든 사이드 팟을 정확하게 계산하여 분배하는 것"** 이었습니다.

수정된 로직은 다음 5단계로 진행됩니다.

### 1단계: 모든 기여자(All Contributors) 식별

이것이 가장 핵심적인 변경 사항입니다.

* 기존 문제: 이전 로직은 쇼다운까지 참여한 플레이어(showdownPlayers)만을 대상으로 팟을 계산했습니다. 이 때문에 중간에 폴드한 플레이어가 팟에
  넣은 돈이 계산에서 완전히 누락되었습니다.
* 수정된 로직:
    1. g.Players 배열을 전체 순회하여 TotalBetInHand > 0인 (즉, 이번 핸드에 1칩이라도 베팅한) 모든 플레이어를 찾아 allContributors 라는 새로운
       슬라이스에 저장합니다.
    2. 이제부터의 모든 계산은 이 allContributors를 기준으로 이루어지므로, 폴드한 플레이어의 베팅 금액도 절대 유실되지 않습니다.

### 2단계: 베팅 계층(Bet Tiers) 생성 및 정렬

사이드 팟을 정확하게 나누기 위한 사전 작업입니다.

* 기존 문제: 플레이어들의 베팅 순서에 따라 팟을 계산하려다 보니 로직이 복잡하고 오류가 발생했습니다.
* 수정된 로직:
    1. allContributors가 베팅한 모든 금액(TotalBetInHand)을 수집하여 중복을 제거한 "베팅 계층(Bet Tiers)" 목록을 만듭니다. 예를 들어,
       플레이어들이 각각 1000, 3000, 3000, 8000을 베팅했다면 [1000, 3000, 8000] 이라는 베팅 계층이 만들어집니다.
    2. 이 계층들을 오름차순으로 정렬합니다 ([1000, 3000, 8000]). 이 순서는 가장 작은 팟(메인 팟)부터 가장 큰 사이드 팟 순서로 계산하기
       위함입니다.

### 3단계: 팟 티어(Pot Tiers) 구축

정렬된 베팅 계층을 기반으로 실제 분배할 팟(메인 팟, 사이드 팟)들을 구체적으로 만듭니다.

* 수정된 로직:
    1. 정렬된 베팅 계층(sortedTiers)을 순회하며 각 팟의 크기를 계산합니다.
    2. 첫 번째 팟 (Main Pot): 가장 낮은 베팅액(1000)을 기준으로, 1000칩 이상을 베팅한 모든 플레이어(allContributors)의 수를 셉니다. 만약 4명이
       1000칩 이상을 냈다면, 메인 팟의 크기는 1000 * 4 = 4000 이 됩니다.
    3. 두 번째 팟 (Side Pot 1): 두 번째 베팅액(3000)과 이전 베팅액(1000)의 차액인 2000을 기준으로, 3000칩 이상을 베팅한 플레이어 수를 셉니다.
       만약 3명이 3000칩 이상을 냈다면, 첫 번째 사이드 팟의 크기는 (3000 - 1000) * 3 = 6000 이 됩니다.
    4. 이 과정을 모든 베팅 계층에 대해 반복하여 pots 라는 슬라이스에 각 팟의 정보(팟 크기, 상금 수령 자격이 있는 플레이어 목록 등)를 담습니다.

이 방식을 통해, 폴드한 플레이어의 돈까지 정확하게 각 팟 티어에 분배됩니다.

### 4단계: 각 팟 티어 분배 및 승자 결정

구축된 pots 슬라이스를 순회하며 실제로 돈을 나눕니다.

* 수정된 로직:
    1. 각 팟 티어별로, 해당 팟에 대한 상금 수령 자격이 있는 플레이어들(eligiblePlayers) 중에서 실제 승자(하이/로우 핸드)를 찾습니다.
    2. 찾아낸 승자(들)에게 해당 팟 티어의 금액(pot.Amount)을 규칙에 맞게 나누어 줍니다.

### 5단계: 결과 취합 및 최종 반환

마지막으로, 분배 결과를 깔끔하게 정리합니다.

* 기존 문제: 한 명의 플레이어가 메인 팟과 사이드 팟을 모두 이겼을 때, DistributionResult가 여러 개 생성되어 테스트가 실패하는 원인이
  되었습니다.
* 수정된 로직:
    1. winnerChipMap 이라는 맵(map)을 사용해서, 돈을 분배할 때마다 플레이어의 이름을 키(key)로 하여 누적 상금을 합산합니다.
    2. 모든 팟 티어의 분배가 끝나면, 이 winnerChipMap을 기반으로 플레이어당 단 하나의 최종 DistributionResult를 생성하여 반환합니다.

이러한 단계를 통해, 어떤 복잡한 베팅과 폴드, 올인 상황에서도 전체 팟의 유실 없이 정확하게 승자에게 상금이 분배될 수 있습니다.
